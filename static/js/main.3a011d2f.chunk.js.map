{"version":3,"sources":["App.js","Weapons.js","index.js"],"names":["PixelPrice","BN","NearConfig","window","location","hostname","networkId","nodeUrl","contractName","walletUrl","Avocado","role","aria-label","className","Banana","Cucumber","Pepper","Berry","intToColor","c","toString","padStart","intToColorWithAlpha","a","Math","round","rgbaToInt","cr","cg","cb","ca","bgColor","bb","bg","br","imgColorToInt","int2hsv","cInt","substr","r","parseInt","g","b","v","max","min","h","transparentColor","generateGamma","hue","gammaColors","i","push","decodeLine","line","buf","Buffer","from","length","Error","pixels","color","readUInt32LE","ownerIndex","App","props","colors","map","toLowerCase","currentColor","substring","timeMs","Date","getTime","freeDrawingStartMsEstimated","OneDayMs","state","connected","signedIn","accountId","pendingPixels","boardLoaded","selectedCell","alpha","pickerColor","pickingColor","owners","accounts","highlightedAccountIndex","selectedOwnerIndex","farmingBanana","weaponsOn","weaponsCodePosition","freeDrawingStart","freeDrawingEnd","_buttonDown","_oldCounts","_numFailedTxs","_balanceRefreshTimer","canvasRef","React","createRef","_context","_lines","_queue","_pendingPixels","_refreshBoardTimer","_sendQueueTimer","_stopRefreshTime","_accounts","_initNear","then","setState","_accountId","ircAccountId","replace","_freeDrawingStart","_freeDrawingEnd","canvas","this","current","getContext","click","rendering","drawImg","pickColor","saveColor","drawPixel","mouseMove","e","x","y","touches","rect","target","getBoundingClientRect","targetTouches","clientX","left","clientY","top","offsetX","offsetY","trunc","clientWidth","clientHeight","cell","JSON","stringify","renderCanvas","preventDefault","addEventListener","mouseDown","unselectCell","mouseUp","buttons","document","altKey","enablePickColor","key","disablePickColor","slice","_contract","draw","console","log","concat","Promise","all","refreshBoard","refreshAccountStats","forEach","p","_pending","ready","clearTimeout","_sendQueue","setTimeout","_pingQueue","balance","account","avocadoBalance","_isFreeDrawing","avocadoNeeded","img","imageData","w","width","height","d","Uint32Array","data","buffer","j","imgColor","account_id","accountIndex","account_index","parseFloat","avocado_balance","_pixelCost","bananaBalance","banana_balance","numPixels","num_pixels","farmingPreference","farming_preference","startTime","avocadoPixels","bananaPixels","avocadoRewardPerMs","bananaRewardPerMs","get_account","parseAccount","get_account_by_index","getAccount","clearInterval","setInterval","t","Object","assign","keyStore","nearAPI","BrowserLocalStorageKeyStore","deps","near","_keyStore","_near","_walletConnection","getAccountId","_account","viewMethods","changeMethods","get_pixel_cost","get_free_drawing_timestamp","freeDrawingTimestamp","_lineVersions","Array","fill","forced","hidden","get_line_versions","lineVersions","needLines","requestLines","lines","get_lines","results","flat","lineIndex","_refreshOwners","counts","sortedKeys","keys","sort","getAccountByIndex","ctx","fillStyle","fillRect","CellWidth","CellHeight","beginPath","strokeStyle","lineWidth","stroke","closePath","arc","PI","requestSignIn","signOut","rgb","changeColor","hsl","newColor","index","indexOf","splice","hex","hsv","amount","requiredBalance","muln","buy_tokens","select_farming_preference","berry","date","isFreeDrawing","freeDrawing","initialTime","direction","timeToUpdate","lastUnit","checkpoints","time","Fragment","Days","formatValue","Hours","Minutes","Seconds","Milliseconds","content","onClick","logOut","Balance","detailed","onChange","switchBerry","checked","offColor","onColor","uncheckedIcon","checkedIcon","buyTokens","hueColorChange","alphaColorChange","triangle","onChangeComplete","style","marginBottom","aria-hidden","weapons","renderIt","renderImg","href","ref","Leaderboard","setHover","title","frameBorder","src","allow","allowFullScreen","data-ribbon","Component","fraction","avacadoBalance","avocadoFarm","bananaFarm","toFixed","owner","Owner","isSelected","isHighlighted","onMouseEnter","onMouseLeave","Account","shortAccountId","Weapons","lockedAspect","sourceImage","Image","onload","clearRect","imageSmoothingQuality","drawImage","getImageData","reduce","sum","f","reader","FileReader","readAsDataURL","naturalWidth","naturalHeight","aspect","event","result","value","type","onFilesChange","onError","onFilesError","multiple","accepts","minFileSize","clickable","updateVal","changeLockedAspect","disabled","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.3a011d2f.chunk.js","sourcesContent":["import \"./App.scss\";\nimport \"./gh-fork-ribbon.css\";\nimport React from \"react\";\nimport BN from \"bn.js\";\nimport * as nearAPI from \"near-api-js\";\nimport { AlphaPicker, HuePicker, GithubPicker } from \"react-color\";\nimport Switch from \"react-switch\";\nimport { Weapons } from \"./Weapons\";\nimport Timer from \"react-compound-timer\";\n\nconst PixelPrice = new BN(\"10000000000000000000000\");\nconst IsMainnet = window.location.hostname === \"berryclub.io\";\nconst TestNearConfig = {\n  networkId: \"testnet\",\n  nodeUrl: \"https://rpc.testnet.near.org\",\n  contractName: \"berryclub.testnet\",\n  walletUrl: \"https://wallet.testnet.near.org\",\n};\nconst MainNearConfig = {\n  networkId: \"mainnet\",\n  nodeUrl: \"https://rpc.mainnet.near.org\",\n  contractName: \"berryclub.ek.near\",\n  walletUrl: \"https://wallet.near.org\",\n};\nconst NearConfig = IsMainnet ? MainNearConfig : TestNearConfig;\n\nconst Avocado = (\n  <span role=\"img\" aria-label=\"avocado\" className=\"berry\">\n    🥑\n  </span>\n);\nconst Banana = (\n  <span role=\"img\" aria-label=\"banana\" className=\"berry\">\n    🍌\n  </span>\n);\nconst Cucumber = (\n  <span role=\"img\" aria-label=\"cucumber\" className=\"berry\">\n    🥒\n  </span>\n);\nconst Pepper = (\n  <span role=\"img\" aria-label=\"pepper\" className=\"berry\">\n    🌶️\n  </span>\n);\n\nconst Berry = {\n  Avocado: \"Avocado\",\n  Banana: \"Banana\",\n};\n\nconst BoardHeight = 50;\nconst BoardWidth = 50;\nconst NumLinesPerFetch = 10;\nconst ExpectedLineLength = 4 + 8 * BoardWidth;\nconst CellWidth = 12;\nconst CellHeight = 12;\nconst MaxNumColors = 31;\nconst BatchOfPixels = 100;\n// 500 ms\nconst BatchTimeout = 500;\nconst RefreshBoardTimeout = 1000;\nconst MaxWorkTime = 10 * 60 * 1000;\nconst OneDayMs = 24 * 60 * 60 * 1000;\n\nconst intToColor = (c) => `#${c.toString(16).padStart(6, \"0\")}`;\nconst intToColorWithAlpha = (c, a) =>\n  `#${c.toString(16).padStart(6, \"0\")}${Math.round(255 * a)\n    .toString(16)\n    .padStart(2, \"0\")}`;\n\nconst rgbaToInt = (cr, cg, cb, ca, bgColor) => {\n  const bb = bgColor & 255;\n  const bg = (bgColor >> 8) & 255;\n  const br = (bgColor >> 16) & 255;\n\n  const r = Math.round(cr * ca + br * (1 - ca));\n  const g = Math.round(cg * ca + bg * (1 - ca));\n  const b = Math.round(cb * ca + bb * (1 - ca));\n  return (r << 16) + (g << 8) + b;\n};\n\nconst imgColorToInt = (c, bgColor) => {\n  const cr = c & 255;\n  const cg = (c >> 8) & 255;\n  const cb = (c >> 16) & 255;\n  const ca = ((c >> 24) & 255) / 255;\n  return rgbaToInt(cr, cg, cb, ca, bgColor);\n};\n\nconst int2hsv = (cInt) => {\n  cInt = intToColor(cInt).substr(1);\n  const r = parseInt(cInt.substr(0, 2), 16) / 255;\n  const g = parseInt(cInt.substr(2, 2), 16) / 255;\n  const b = parseInt(cInt.substr(4, 2), 16) / 255;\n  let v = Math.max(r, g, b),\n    c = v - Math.min(r, g, b);\n  let h =\n    c && (v === r ? (g - b) / c : v === g ? 2 + (b - r) / c : 4 + (r - g) / c);\n  return [60 * (h < 0 ? h + 6 : h), v && c / v, v];\n};\nconst transparentColor = (c, a) =>\n  `rgba(${c >> 16}, ${(c >> 8) & 0xff}, ${c & 0xff}, ${a})`;\nconst generateGamma = (hue) => {\n  const gammaColors = [];\n  for (let i = 0; i < MaxNumColors; ++i) {\n    gammaColors.push(`hsl(${hue}, 100%, ${(100 * i) / (MaxNumColors - 1)}%)`);\n  }\n  return gammaColors;\n};\nconst decodeLine = (line) => {\n  let buf = Buffer.from(line, \"base64\");\n  if (buf.length !== ExpectedLineLength) {\n    throw new Error(\"Unexpected encoded line length\");\n  }\n  let pixels = [];\n  for (let i = 4; i < buf.length; i += 8) {\n    let color = buf.readUInt32LE(i);\n    let ownerIndex = buf.readUInt32LE(i + 4);\n    pixels.push({\n      color,\n      ownerIndex,\n    });\n  }\n  return pixels;\n};\n\nconst WeaponsCheat = \"idkfa\";\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    const colors = [\n      \"#000000\",\n      \"#666666\",\n      \"#aaaaaa\",\n      \"#FFFFFF\",\n      \"#F44E3B\",\n      \"#D33115\",\n      \"#9F0500\",\n      \"#FE9200\",\n      \"#E27300\",\n      \"#C45100\",\n      \"#FCDC00\",\n      \"#FCC400\",\n      \"#FB9E00\",\n      \"#DBDF00\",\n      \"#B0BC00\",\n      \"#808900\",\n      \"#A4DD00\",\n      \"#68BC00\",\n      \"#194D33\",\n      \"#68CCCA\",\n      \"#16A5A5\",\n      \"#0C797D\",\n      \"#73D8FF\",\n      \"#009CE0\",\n      \"#0062B1\",\n      \"#AEA1FF\",\n      \"#7B64FF\",\n      \"#653294\",\n      \"#FDA1FF\",\n      \"#FA28FF\",\n      \"#AB149E\",\n    ].map((c) => c.toLowerCase());\n    // const currentColor = parseInt(colors[Math.floor(Math.random() * colors.length)].substring(1), 16);\n    const currentColor = parseInt(colors[0].substring(1), 16);\n    const defaultAlpha = 0.25;\n\n    const timeMs = new Date().getTime();\n    const freeDrawingStartMsEstimated =\n      timeMs -\n      ((timeMs - new Date(\"2021-05-09\")) % (7 * OneDayMs)) +\n      OneDayMs * 6;\n\n    this.state = {\n      connected: false,\n      signedIn: false,\n      accountId: null,\n      pendingPixels: 0,\n      boardLoaded: false,\n      selectedCell: null,\n      alpha: defaultAlpha,\n      currentColor,\n      pickerColor: intToColorWithAlpha(currentColor, defaultAlpha),\n      colors,\n      gammaColors: generateGamma(0),\n      pickingColor: false,\n      owners: [],\n      accounts: {},\n      highlightedAccountIndex: -1,\n      selectedOwnerIndex: false,\n      farmingBanana: false,\n      weaponsOn: false,\n      weaponsCodePosition: 0,\n      freeDrawingStart: new Date(freeDrawingStartMsEstimated),\n      freeDrawingEnd: new Date(freeDrawingStartMsEstimated + OneDayMs),\n    };\n\n    this._buttonDown = false;\n    this._oldCounts = {};\n    this._numFailedTxs = 0;\n    this._balanceRefreshTimer = null;\n    this.canvasRef = React.createRef();\n    this._context = false;\n    this._lines = false;\n    this._queue = [];\n    this._pendingPixels = [];\n    this._refreshBoardTimer = null;\n    this._sendQueueTimer = null;\n    this._stopRefreshTime = new Date().getTime() + MaxWorkTime;\n    this._accounts = {};\n\n    this._initNear().then(() => {\n      this.setState({\n        connected: true,\n        signedIn: !!this._accountId,\n        accountId: this._accountId,\n        ircAccountId: this._accountId.replace(\".\", \"_\"),\n        freeDrawingStart: this._freeDrawingStart,\n        freeDrawingEnd: this._freeDrawingEnd,\n      });\n    });\n  }\n\n  componentDidMount() {\n    const canvas = this.canvasRef.current;\n    this._context = canvas.getContext(\"2d\");\n\n    const click = async () => {\n      if (this.state.rendering) {\n        await this.drawImg(this.state.selectedCell);\n      } else if (this.state.pickingColor) {\n        this.pickColor(this.state.selectedCell);\n      } else {\n        this.saveColor();\n        await this.drawPixel(this.state.selectedCell);\n      }\n    };\n\n    const mouseMove = (e) => {\n      let x, y;\n      if (\"touches\" in e) {\n        if (e.touches.length > 1) {\n          return true;\n        } else {\n          const rect = e.target.getBoundingClientRect();\n          x = e.targetTouches[0].clientX - rect.left;\n          y = e.targetTouches[0].clientY - rect.top;\n        }\n      } else {\n        x = e.offsetX;\n        y = e.offsetY;\n      }\n      x = Math.trunc((x / e.target.clientWidth) * BoardWidth);\n      y = Math.trunc((y / e.target.clientHeight) * BoardWidth);\n      let cell = null;\n      if (x >= 0 && x < BoardWidth && y >= 0 && y < BoardHeight) {\n        cell = { x, y };\n      }\n      if (JSON.stringify(cell) !== JSON.stringify(this.state.selectedCell)) {\n        this.setState(\n          {\n            selectedCell: cell,\n            selectedOwnerIndex:\n              this._lines &&\n              cell &&\n              this._lines[cell.y] &&\n              this._lines[cell.y][cell.x].ownerIndex,\n          },\n          async () => {\n            this.renderCanvas();\n            if (this.state.selectedCell !== null && this._buttonDown) {\n              await click();\n            }\n          }\n        );\n      }\n      e.preventDefault();\n      return false;\n    };\n\n    canvas.addEventListener(\"mousemove\", mouseMove);\n    canvas.addEventListener(\"touchmove\", mouseMove);\n\n    const mouseDown = async (e) => {\n      this._buttonDown = true;\n      if (this.state.selectedCell !== null) {\n        await click();\n      }\n    };\n\n    canvas.addEventListener(\"mousedown\", mouseDown);\n    canvas.addEventListener(\"touchstart\", mouseDown);\n\n    const unselectCell = () => {\n      this.setState(\n        {\n          selectedCell: null,\n        },\n        () => this.renderCanvas()\n      );\n    };\n\n    const mouseUp = async (e) => {\n      this._buttonDown = false;\n      if (\"touches\" in e) {\n        unselectCell();\n      }\n    };\n\n    canvas.addEventListener(\"mouseup\", mouseUp);\n    canvas.addEventListener(\"touchend\", mouseUp);\n\n    canvas.addEventListener(\"mouseleave\", unselectCell);\n\n    canvas.addEventListener(\"mouseenter\", (e) => {\n      if (this._buttonDown) {\n        if (!(\"touches\" in e) && !(e.buttons & 1)) {\n          this._buttonDown = false;\n        }\n      }\n    });\n\n    document.addEventListener(\"keydown\", (e) => {\n      e.altKey && this.enablePickColor();\n    });\n\n    document.addEventListener(\"keyup\", (e) => {\n      if (this.state.weaponsCodePosition < WeaponsCheat.length) {\n        if (\n          e.key.toLowerCase() === WeaponsCheat[this.state.weaponsCodePosition]\n        ) {\n          this.setState({\n            weaponsCodePosition: this.state.weaponsCodePosition + 1,\n            weaponsOn:\n              this.state.weaponsCodePosition + 1 === WeaponsCheat.length,\n          });\n        } else {\n          this.setState({\n            weaponsCodePosition: 0,\n          });\n        }\n      }\n      !e.altKey && this.disablePickColor();\n    });\n  }\n\n  enablePickColor() {\n    this.setState(\n      {\n        pickingColor: true,\n      },\n      () => {\n        this.renderCanvas();\n      }\n    );\n  }\n\n  disablePickColor() {\n    this.setState(\n      {\n        pickingColor: false,\n      },\n      () => {\n        this.renderCanvas();\n      }\n    );\n  }\n\n  pickColor(cell) {\n    if (!this.state.signedIn || !this._lines || !this._lines[cell.y]) {\n      return;\n    }\n    const color = this._lines[cell.y][cell.x].color;\n\n    this.setState(\n      {\n        currentColor: color,\n        alpha: 1,\n        pickerColor: intToColorWithAlpha(color, 1),\n        gammaColors: generateGamma(int2hsv(color)[0]),\n        pickingColor: false,\n      },\n      () => {\n        this.renderCanvas();\n      }\n    );\n  }\n\n  async _sendQueue() {\n    const pixels = this._queue.slice(0, BatchOfPixels);\n    this._queue = this._queue.slice(BatchOfPixels);\n    this._pendingPixels = pixels;\n\n    try {\n      await this._contract.draw(\n        {\n          pixels,\n        },\n        new BN(\"75000000000000\")\n      );\n      this._numFailedTxs = 0;\n    } catch (error) {\n      console.log(\"Failed to send a transaction\", error);\n      this._numFailedTxs += 1;\n      if (this._numFailedTxs < 3) {\n        this._queue = this._queue.concat(this._pendingPixels);\n        this._pendingPixels = [];\n      } else {\n        this._pendingPixels = [];\n        this._queue = [];\n      }\n    }\n    try {\n      await Promise.all([this.refreshBoard(true), this.refreshAccountStats()]);\n    } catch (e) {\n      // ignore\n    }\n    this._pendingPixels.forEach((p) => {\n      if (this._pending[p.y][p.x] === p.color) {\n        this._pending[p.y][p.x] = -1;\n      }\n    });\n    this._pendingPixels = [];\n  }\n\n  async _pingQueue(ready) {\n    if (this._sendQueueTimer) {\n      clearTimeout(this._sendQueueTimer);\n      this._sendQueueTimer = null;\n    }\n\n    if (\n      this._pendingPixels.length === 0 &&\n      (this._queue.length >= BatchOfPixels || ready)\n    ) {\n      await this._sendQueue();\n    }\n    if (this._queue.length > 0) {\n      this._sendQueueTimer = setTimeout(async () => {\n        await this._pingQueue(true);\n      }, BatchTimeout);\n    }\n  }\n\n  async drawImg(cell) {\n    if (!this.state.signedIn || !this._lines || !this._lines[cell.y]) {\n      return;\n    }\n    const balance = this.state.account ? this.state.account.avocadoBalance : 0;\n\n    if (\n      !this._isFreeDrawing() &&\n      balance - this.state.pendingPixels < this.state.avocadoNeeded\n    ) {\n      return;\n    }\n\n    const img = this.imageData;\n    const w = img.width;\n    const h = img.height;\n    const x = cell.x - Math.trunc(w / 2);\n    const y = cell.y - Math.trunc(h / 2);\n    const d = new Uint32Array(this.imageData.data.buffer);\n    for (let i = 0; i < h; ++i) {\n      for (let j = 0; j < w; ++j) {\n        const imgColor = d[i * w + j];\n        if (\n          imgColor &&\n          y + i >= 0 &&\n          y + i < BoardHeight &&\n          x + j >= 0 &&\n          x + j < BoardWidth\n        ) {\n          const bgColor = this._lines[y + i]\n            ? this._lines[y + i][x + j].color\n            : 0;\n          const color = imgColorToInt(imgColor, bgColor);\n          if (color !== bgColor) {\n            this._queue.push({\n              x: x + j,\n              y: y + i,\n              color,\n            });\n          }\n        }\n      }\n    }\n    this.setState({\n      rendering: false,\n    });\n\n    this._stopRefreshTime = new Date().getTime() + MaxWorkTime;\n    await this._pingQueue(false);\n  }\n\n  async drawPixel(cell) {\n    if (!this.state.signedIn || !this._lines || !this._lines[cell.y]) {\n      return;\n    }\n    const balance = this.state.account ? this.state.account.avocadoBalance : 0;\n    if (!this._isFreeDrawing() && balance - this.state.pendingPixels < 1) {\n      return;\n    }\n\n    const bgColor = this._lines[cell.y] ? this._lines[cell.y][cell.x].color : 0;\n    const cb = this.state.currentColor & 255;\n    const cg = (this.state.currentColor >> 8) & 255;\n    const cr = (this.state.currentColor >> 16) & 255;\n    const color = rgbaToInt(cr, cg, cb, this.state.alpha, bgColor);\n\n    if (\n      this._pending[cell.y][cell.x] !== color &&\n      this._lines[cell.y][cell.x].color !== color\n    ) {\n      this._pending[cell.y][cell.x] = color;\n    } else {\n      return;\n    }\n\n    this._queue.push({\n      x: cell.x,\n      y: cell.y,\n      color,\n    });\n\n    this._stopRefreshTime = new Date().getTime() + MaxWorkTime;\n    await this._pingQueue(false);\n  }\n\n  parseAccount(account, accountId) {\n    if (!account) {\n      account = {\n        accountId,\n        accountIndex: -1,\n        avocadoBalance: 25.0,\n        bananaBalance: 0.0,\n        numPixels: 0,\n        farmingPreference: Berry.Avocado,\n      };\n    } else {\n      account = {\n        accountId: account.account_id,\n        accountIndex: account.account_index,\n        avocadoBalance: parseFloat(account.avocado_balance) / this._pixelCost,\n        bananaBalance: parseFloat(account.banana_balance) / this._pixelCost,\n        numPixels: account.num_pixels,\n        farmingPreference: account.farming_preference,\n      };\n    }\n    account.startTime = new Date().getTime();\n    account.avocadoPixels =\n      account.farmingPreference === Berry.Avocado ? account.numPixels + 1 : 0;\n    account.bananaPixels =\n      account.farmingPreference === Berry.Banana ? account.numPixels : 0;\n    account.avocadoRewardPerMs = account.avocadoPixels / (24 * 60 * 60 * 1000);\n    account.bananaRewardPerMs = account.bananaPixels / (24 * 60 * 60 * 1000);\n    return account;\n  }\n\n  async getAccount(accountId) {\n    return this.parseAccount(\n      await this._contract.get_account({ account_id: accountId }),\n      accountId\n    );\n  }\n\n  async getAccountByIndex(accountIndex) {\n    return this.parseAccount(\n      await this._contract.get_account_by_index({\n        account_index: accountIndex,\n      }),\n      \"unknown\"\n    );\n  }\n\n  async refreshAccountStats() {\n    let account = await this.getAccount(this._accountId);\n    if (this._balanceRefreshTimer) {\n      clearInterval(this._balanceRefreshTimer);\n      this._balanceRefreshTimer = null;\n    }\n\n    this.setState({\n      pendingPixels: this._pendingPixels.length + this._queue.length,\n      farmingBanana: account.farmingPreference === Berry.Banana,\n      account,\n    });\n\n    this._balanceRefreshTimer = setInterval(() => {\n      const t = new Date().getTime() - account.startTime;\n      this.setState({\n        account: Object.assign({}, account, {\n          avocadoBalance:\n            account.avocadoBalance + t * account.avocadoRewardPerMs,\n          bananaBalance: account.bananaBalance + t * account.bananaRewardPerMs,\n        }),\n        pendingPixels: this._pendingPixels.length + this._queue.length,\n      });\n    }, 100);\n  }\n\n  async _initNear() {\n    const keyStore = new nearAPI.keyStores.BrowserLocalStorageKeyStore();\n    const near = await nearAPI.connect(\n      Object.assign({ deps: { keyStore } }, NearConfig)\n    );\n    this._keyStore = keyStore;\n    this._near = near;\n\n    this._walletConnection = new nearAPI.WalletConnection(\n      near,\n      NearConfig.contractName\n    );\n    this._accountId = this._walletConnection.getAccountId();\n\n    this._account = this._walletConnection.account();\n    this._contract = new nearAPI.Contract(\n      this._account,\n      NearConfig.contractName,\n      {\n        viewMethods: [\n          \"get_account\",\n          \"get_account_by_index\",\n          \"get_lines\",\n          \"get_line_versions\",\n          \"get_pixel_cost\",\n          \"get_account_balance\",\n          \"get_account_num_pixels\",\n          \"get_account_id_by_index\",\n          \"get_free_drawing_timestamp\",\n        ],\n        changeMethods: [\"draw\", \"buy_tokens\", \"select_farming_preference\"],\n      }\n    );\n    this._pixelCost = parseFloat(await this._contract.get_pixel_cost());\n    const freeDrawingTimestamp = await this._contract.get_free_drawing_timestamp();\n    this._freeDrawingStart = new Date(freeDrawingTimestamp);\n    this._freeDrawingEnd = new Date(freeDrawingTimestamp + OneDayMs);\n    if (this._accountId) {\n      await this.refreshAccountStats();\n    }\n    this._lineVersions = Array(BoardHeight).fill(-1);\n    this._lines = Array(BoardHeight).fill(false);\n    this._pending = Array(BoardHeight).fill(false);\n    this._pending.forEach((v, i, a) => (a[i] = Array(BoardWidth).fill(-1)));\n    await this.refreshBoard(true);\n  }\n\n  async refreshBoard(forced) {\n    if (this._refreshBoardTimer) {\n      clearTimeout(this._refreshBoardTimer);\n      this._refreshBoardTimer = null;\n    }\n    const t = new Date().getTime();\n    if (t < this._stopRefreshTime) {\n      this._refreshBoardTimer = setTimeout(async () => {\n        await this.refreshBoard(false);\n      }, RefreshBoardTimeout);\n    }\n\n    if (!forced && document.hidden) {\n      return;\n    }\n\n    let lineVersions = await this._contract.get_line_versions();\n    let needLines = [];\n    for (let i = 0; i < BoardHeight; ++i) {\n      if (lineVersions[i] !== this._lineVersions[i]) {\n        needLines.push(i);\n      }\n    }\n    let requestLines = [];\n    for (let i = 0; i < needLines.length; i += NumLinesPerFetch) {\n      requestLines.push(needLines.slice(i, i + NumLinesPerFetch));\n    }\n\n    let results = await Promise.all(\n      requestLines.map((lines) => this._contract.get_lines({ lines }))\n    );\n    results = results.flat();\n    requestLines = requestLines.flat();\n    for (let i = 0; i < requestLines.length; ++i) {\n      let lineIndex = requestLines[i];\n      let line = decodeLine(results[i]);\n      this._lines[lineIndex] = line;\n    }\n\n    this._lineVersions = lineVersions;\n    this._refreshOwners();\n    this.renderCanvas();\n  }\n\n  _refreshOwners() {\n    const counts = {};\n    this._lines.flat().forEach((cell) => {\n      counts[cell.ownerIndex] = (counts[cell.ownerIndex] || 0) + 1;\n    });\n    delete counts[0];\n    const sortedKeys = Object.keys(counts).sort(\n      (a, b) => counts[b] - counts[a]\n    );\n    this.setState({\n      owners: sortedKeys.map((accountIndex) => {\n        accountIndex = parseInt(accountIndex);\n        return {\n          accountIndex,\n          numPixels: counts[accountIndex],\n        };\n      }),\n    });\n    sortedKeys.forEach(async (accountIndex) => {\n      accountIndex = parseInt(accountIndex);\n      if (\n        !(accountIndex in this._accounts) ||\n        counts[accountIndex] !== (this._oldCounts[accountIndex] || 0)\n      ) {\n        try {\n          this._accounts[accountIndex] = await this.getAccountByIndex(\n            accountIndex\n          );\n        } catch (err) {\n          console.log(\"Failed to fetch account index #\", accountIndex, err);\n        }\n        this.setState({\n          accounts: Object.assign({}, this._accounts),\n        });\n      }\n    });\n    this.setState({\n      accounts: Object.assign({}, this._accounts),\n    });\n    this._oldCounts = counts;\n  }\n\n  renderCanvas() {\n    if (!this._context || !this._lines) {\n      return;\n    }\n\n    const ctx = this._context;\n\n    for (let i = 0; i < BoardHeight; ++i) {\n      const line = this._lines[i];\n      if (!line) {\n        continue;\n      }\n      for (let j = 0; j < BoardWidth; ++j) {\n        const p = line[j];\n        ctx.fillStyle = intToColor(p.color);\n        ctx.fillRect(j * CellWidth, i * CellHeight, CellWidth, CellHeight);\n        if (this.state.highlightedAccountIndex >= 0) {\n          if (p.ownerIndex !== this.state.highlightedAccountIndex) {\n            ctx.fillStyle = \"rgba(32, 32, 32, 0.8)\";\n            ctx.fillRect(\n              j * CellWidth,\n              i * CellHeight,\n              CellWidth / 2,\n              CellHeight / 2\n            );\n            ctx.fillRect(\n              (j + 0.5) * CellWidth,\n              (i + 0.5) * CellHeight,\n              CellWidth / 2,\n              CellHeight / 2\n            );\n            ctx.fillStyle = \"rgba(0, 0, 0, 0.8)\";\n            ctx.fillRect(\n              j * CellWidth,\n              (i + 0.5) * CellHeight,\n              CellWidth / 2,\n              CellHeight / 2\n            );\n            ctx.fillRect(\n              (j + 0.5) * CellWidth,\n              i * CellHeight,\n              CellWidth / 2,\n              CellHeight / 2\n            );\n          } else {\n            ctx.beginPath();\n            ctx.strokeStyle = ctx.fillStyle = \"rgba(255, 255, 255, 0.8)\";\n            ctx.lineWidth = 0.5;\n            ctx.rect(\n              j * CellWidth + 0.5,\n              i * CellHeight + 0.5,\n              CellWidth - 1,\n              CellHeight - 1\n            );\n            ctx.stroke();\n            ctx.closePath();\n          }\n        }\n      }\n    }\n\n    this._pendingPixels.concat(this._queue).forEach((p) => {\n      ctx.fillStyle = intToColor(p.color);\n      ctx.fillRect(p.x * CellWidth, p.y * CellHeight, CellWidth, CellHeight);\n    });\n\n    if (this.state.selectedCell) {\n      const c = this.state.selectedCell;\n      if (this.state.rendering) {\n        const img = this.imageData;\n        const w = img.width;\n        const h = img.height;\n        const x = c.x - Math.trunc(w / 2);\n        const y = c.y - Math.trunc(h / 2);\n        const d = new Uint32Array(this.imageData.data.buffer);\n        for (let i = 0; i < h; ++i) {\n          for (let j = 0; j < w; ++j) {\n            const color = d[i * w + j];\n            if (\n              color &&\n              y + i >= 0 &&\n              y + i < BoardHeight &&\n              x + j >= 0 &&\n              x + j < BoardWidth\n            ) {\n              const bgColor = this._lines[y + i]\n                ? this._lines[y + i][x + j].color\n                : 0;\n              ctx.fillStyle = intToColor(imgColorToInt(color, bgColor));\n              ctx.fillRect(\n                (x + j) * CellWidth,\n                (y + i) * CellHeight,\n                CellWidth,\n                CellHeight\n              );\n            }\n          }\n        }\n      } else if (this.state.pickingColor) {\n        const color = this._lines[c.y] ? this._lines[c.y][c.x].color : 0;\n        ctx.beginPath();\n        ctx.strokeStyle = ctx.fillStyle = transparentColor(color, 0.5);\n        ctx.lineWidth = CellWidth * 4;\n        ctx.arc(\n          (c.x + 0.5) * CellWidth,\n          (c.y + 0.5) * CellHeight,\n          CellWidth * 4,\n          0,\n          2 * Math.PI\n        );\n        ctx.stroke();\n        ctx.closePath();\n\n        ctx.beginPath();\n        ctx.strokeStyle = ctx.fillStyle = transparentColor(color, 1);\n        ctx.lineWidth = CellWidth * 2;\n        ctx.arc(\n          (c.x + 0.5) * CellWidth,\n          (c.y + 0.5) * CellHeight,\n          CellWidth * 4,\n          0,\n          2 * Math.PI\n        );\n        ctx.stroke();\n        ctx.closePath();\n      } else {\n        ctx.fillStyle = transparentColor(this.state.currentColor, 0.2);\n        ctx.fillRect(c.x * CellWidth, 0, CellWidth, c.y * CellHeight);\n        ctx.fillRect(\n          c.x * CellWidth,\n          (c.y + 1) * CellHeight,\n          CellWidth,\n          (BoardHeight - c.y - 1) * CellHeight\n        );\n        ctx.fillRect(0, c.y * CellHeight, c.x * CellWidth, CellHeight);\n        ctx.fillRect(\n          (c.x + 1) * CellWidth,\n          c.y * CellHeight,\n          (BoardWidth - c.x - 1) * CellWidth,\n          CellHeight\n        );\n\n        ctx.beginPath();\n        ctx.lineWidth = 3;\n        ctx.fillStyle = intToColor(this.state.currentColor);\n        ctx.strokeStyle = intToColor(this.state.currentColor);\n        ctx.rect(c.x * CellWidth, c.y * CellHeight, CellWidth, CellHeight);\n        ctx.stroke();\n        ctx.closePath();\n      }\n    }\n\n    if (!this.state.boardLoaded) {\n      this.setState({\n        boardLoaded: true,\n      });\n    }\n  }\n\n  async requestSignIn() {\n    const appTitle = \"Berry Club\";\n    await this._walletConnection.requestSignIn(\n      NearConfig.contractName,\n      appTitle\n    );\n  }\n\n  async logOut() {\n    this._walletConnection.signOut();\n    this._accountId = null;\n    this.setState({\n      signedIn: !!this._accountId,\n      accountId: this._accountId,\n    });\n  }\n\n  async alphaColorChange(c) {\n    this.setState(\n      {\n        alpha: c.rgb.a,\n      },\n      () => {\n        this.changeColor(c, c.rgb.a);\n      }\n    );\n  }\n\n  hueColorChange(c) {\n    this.setState({\n      gammaColors: generateGamma(c.hsl.h),\n    });\n    this.changeColor(c);\n  }\n\n  saveColor() {\n    const newColor = intToColor(this.state.currentColor);\n    const index = this.state.colors.indexOf(newColor);\n    if (index >= 0) {\n      this.state.colors.splice(index, 1);\n    }\n    this.setState({\n      colors: [newColor].concat(this.state.colors).slice(0, MaxNumColors),\n    });\n  }\n\n  changeColor(c, alpha) {\n    alpha = alpha || 1.0;\n    const currentColor = c.rgb.r * 0x010000 + c.rgb.g * 0x000100 + c.rgb.b;\n    c.hex = intToColorWithAlpha(currentColor, alpha);\n    c.rgb.a = alpha;\n    c.hsl.a = alpha;\n    c.hsv.a = alpha;\n    this.setState(\n      {\n        pickerColor: c,\n        alpha,\n        currentColor,\n      },\n      () => {\n        this.renderCanvas();\n      }\n    );\n  }\n\n  async buyTokens(amount) {\n    const requiredBalance = PixelPrice.muln(amount);\n    await this._contract.buy_tokens(\n      {},\n      new BN(\"30000000000000\"),\n      requiredBalance\n    );\n  }\n\n  setHover(accountIndex, v) {\n    if (v) {\n      this.setState(\n        {\n          highlightedAccountIndex: accountIndex,\n        },\n        () => {\n          this.renderCanvas();\n        }\n      );\n    } else if (this.state.highlightedAccountIndex === accountIndex) {\n      this.setState(\n        {\n          highlightedAccountIndex: -1,\n        },\n        () => {\n          this.renderCanvas();\n        }\n      );\n    }\n  }\n\n  async switchBerry(farmingBanana) {\n    this.setState({\n      farmingBanana,\n    });\n    await this._contract.select_farming_preference({\n      berry: farmingBanana ? Berry.Banana : Berry.Avocado,\n    });\n    await this.refreshAccountStats();\n  }\n\n  async renderImg(img, avocadoNeeded) {\n    this.imageData = img;\n    this.setState({\n      weaponsOn: false,\n      weaponsCodePosition: 0,\n      rendering: true,\n      pickingColor: false,\n      avocadoNeeded,\n    });\n  }\n\n  _isFreeDrawing() {\n    const date = new Date();\n    return (\n      this.state.freeDrawingStart <= date && date < this.state.freeDrawingEnd\n    );\n  }\n\n  render() {\n    const isFreeDrawing = this._isFreeDrawing();\n    const freeDrawing = (\n      <div className={`free-drawing ${isFreeDrawing ? \"free\" : \"wait\"}`}>\n        {isFreeDrawing\n          ? \"BANANZA!!! Draw for free \"\n          : \"Time until free drawing \"}\n        <Timer\n          initialTime={\n            isFreeDrawing\n              ? this.state.freeDrawingEnd - new Date()\n              : this.state.freeDrawingStart - new Date()\n          }\n          direction=\"backward\"\n          timeToUpdate={100}\n          lastUnit=\"d\"\n          checkpoints={[\n            {\n              time: 0,\n            },\n          ]}\n        >\n          {() => (\n            <React.Fragment>\n              <Timer.Days\n                formatValue={(v) => (v > 1 ? `${v} days ` : v ? `1 day ` : \"\")}\n              />\n              <Timer.Hours />:\n              <Timer.Minutes formatValue={(v) => `${v}`.padStart(2, \"0\")} />:\n              <Timer.Seconds formatValue={(v) => `${v}`.padStart(2, \"0\")} />.\n              <Timer.Milliseconds\n                formatValue={(v) => `${v}`.padStart(3, \"0\")}\n              />\n            </React.Fragment>\n          )}\n        </Timer>\n      </div>\n    );\n\n    const content = !this.state.connected ? (\n      <div>\n        Connecting...{\" \"}\n        <span\n          className=\"spinner-grow spinner-grow-sm\"\n          role=\"status\"\n          aria-hidden=\"true\"\n        />\n      </div>\n    ) : this.state.signedIn ? (\n      <div>\n        <div className=\"float-right\">\n          <button\n            className=\"btn btn-outline-secondary\"\n            onClick={() => this.logOut()}\n          >\n            Log out ({this.state.accountId})\n          </button>\n        </div>\n        {freeDrawing}\n        <div className=\"your-balance\">\n          Balance:{\" \"}\n          <Balance\n            account={this.state.account}\n            pendingPixels={this.state.pendingPixels}\n            isFreeDrawing={isFreeDrawing}\n            detailed={true}\n          />\n          <div>\n            Farming preference:\n            <Switch\n              onChange={(e) => this.switchBerry(e)}\n              checked={this.state.farmingBanana}\n              className=\"react-switch\"\n              height={30}\n              width={70}\n              offColor=\"#666\"\n              onColor=\"#666\"\n              uncheckedIcon={\n                <div className=\"switch-berry avocado\">{Avocado}</div>\n              }\n              checkedIcon={<div className=\"switch-berry banana\">{Banana}</div>}\n            />\n          </div>\n        </div>\n        <div className=\"buttons\">\n          <button\n            className=\"btn btn-primary\"\n            onClick={() => this.buyTokens(10)}\n          >\n            Buy <span className=\"font-weight-bold\">25{Avocado}</span> for{\" \"}\n            <span className=\"font-weight-bold\">Ⓝ0.1</span>\n          </button>{\" \"}\n          <button\n            className=\"btn btn-primary\"\n            onClick={() => this.buyTokens(40)}\n          >\n            Buy <span className=\"font-weight-bold\">100{Avocado}</span> for{\" \"}\n            <span className=\"font-weight-bold\">Ⓝ0.4</span>\n          </button>{\" \"}\n          <button\n            className=\"btn btn-primary\"\n            onClick={() => this.buyTokens(100)}\n          >\n            Buy <span className=\"font-weight-bold\">250{Avocado}</span> for{\" \"}\n            <span className=\"font-weight-bold\">Ⓝ1</span>\n          </button>{\" \"}\n          <button\n            className=\"btn btn-success\"\n            onClick={() => this.buyTokens(500)}\n          >\n            DEAL: Buy <span className=\"font-weight-bold\">1500{Avocado}</span>{\" \"}\n            for <span className=\"font-weight-bold\">Ⓝ5</span>\n          </button>\n        </div>\n        <div className=\"color-picker\">\n          <HuePicker\n            color={this.state.pickerColor}\n            width=\"100%\"\n            onChange={(c) => this.hueColorChange(c)}\n          />\n          <AlphaPicker\n            color={this.state.pickerColor}\n            width=\"100%\"\n            onChange={(c) => this.alphaColorChange(c)}\n          />\n          <div\n            className={this.state.alpha >= 0.75 ? \"display-warning\" : \"hidden\"}\n          >\n            <span role=\"img\" aria-label=\"warning\">\n              ⚠️\n            </span>\n            ️ Please! Don't destroy art! If you just want to farm {Banana}, just\n            draw with low opacity.\n            <span role=\"img\" aria-label=\"pray\">\n              🙏\n            </span>\n            ️\n          </div>\n          <GithubPicker\n            className=\"circle-picker\"\n            colors={this.state.gammaColors}\n            color={this.state.pickerColor}\n            triangle=\"hide\"\n            width=\"100%\"\n            onChangeComplete={(c) => this.changeColor(c)}\n          />\n          <GithubPicker\n            className=\"circle-picker\"\n            colors={this.state.colors}\n            color={this.state.pickerColor}\n            triangle=\"hide\"\n            width=\"100%\"\n            onChangeComplete={(c) => this.hueColorChange(c)}\n          />\n        </div>\n      </div>\n    ) : (\n      <div style={{ marginBottom: \"10px\" }}>\n        <button\n          className=\"btn btn-primary\"\n          onClick={() => this.requestSignIn()}\n        >\n          Log in with NEAR Wallet\n        </button>\n      </div>\n    );\n    const weapons = this.state.weaponsOn ? (\n      <div>\n        <Weapons\n          account={this.state.account}\n          isFreeDrawing={isFreeDrawing}\n          renderIt={(img, avocadoNeeded) => this.renderImg(img, avocadoNeeded)}\n        />\n      </div>\n    ) : (\n      \"\"\n    );\n    return (\n      <div>\n        <div className=\"header\">\n          <h2>\n            {Avocado} Berry Club {Banana}\n          </h2>{\" \"}\n          <a className=\"btn btn-outline-none\" href=\"https://farm.berryclub.io\">\n            Berry Farm {Cucumber}\n          </a>\n          <a\n            className=\"btn btn-outline-none\"\n            href=\"https://app.ref.finance/#wrap.near|berryclub.ek.near\"\n          >\n            REF Finance {Banana}\n          </a>\n          <a className=\"btn btn-outline-none\" href=\"https://berry.cards\">\n            [BETA] Berry Cards {Pepper}\n          </a>\n          {content}\n        </div>\n        <div className=\"container\">\n          <div className=\"row\">\n            <div>\n              <div>\n                <canvas\n                  ref={this.canvasRef}\n                  width={600}\n                  height={600}\n                  className={\n                    this.state.boardLoaded\n                      ? \"pixel-board\"\n                      : \"pixel-board c-animated-background\"\n                  }\n                />\n              </div>\n            </div>\n            <div className=\"leaderboard\">\n              <div>\n                <Leaderboard\n                  owners={this.state.owners}\n                  accounts={this.state.accounts}\n                  setHover={(accountIndex, v) => this.setHover(accountIndex, v)}\n                  selectedOwnerIndex={this.state.selectedOwnerIndex}\n                  highlightedAccountIndex={this.state.highlightedAccountIndex}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n        <div className=\"padded\">\n          {this.state.signedIn ? (\n            <div>\n              <iframe\n                title=\"irc\"\n                className=\"irc\"\n                frameBorder=\"0\"\n                src={`https://kiwiirc.com/client/irc.kiwiirc.com/?nick=${this.state.ircAccountId}#berryclub`}\n              />\n            </div>\n          ) : (\n            \"\"\n          )}\n        </div>\n        <div className=\"padded\">\n          <div className=\"video-container\">\n            <iframe\n              title=\"youtube3\"\n              className=\"youtube\"\n              src=\"https://www.youtube.com/embed/wfTa-Kgw2DM\"\n              frameBorder=\"0\"\n              allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n              allowFullScreen\n            />\n          </div>\n        </div>\n        <div className=\"padded\">\n          <div className=\"video-container\">\n            <iframe\n              title=\"youtube2\"\n              className=\"youtube\"\n              src=\"https://www.youtube.com/embed/PYF6RWd7ZgI\"\n              frameBorder=\"0\"\n              allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n              allowFullScreen\n            />\n          </div>\n        </div>\n        <div className=\"padded\">\n          <div className=\"video-container\">\n            <iframe\n              title=\"youtube\"\n              className=\"youtube\"\n              src=\"https://www.youtube.com/embed/lMSWhCwstLo\"\n              frameBorder=\"0\"\n              allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n              allowFullScreen\n            />\n          </div>\n        </div>\n        {weapons}\n        <a\n          className=\"github-fork-ribbon right-bottom fixed\"\n          href=\"https://github.com/evgenykuzyakov/berryclub\"\n          data-ribbon=\"Fork me on GitHub\"\n          title=\"Fork me on GitHub\"\n        >\n          Fork me on GitHub\n        </a>\n      </div>\n    );\n  }\n}\n\nconst Balance = (props) => {\n  const account = props.account;\n  if (!account) {\n    return \"\";\n  }\n  const fraction = props.detailed ? 3 : 1;\n  const avacadoBalance =\n    account.avocadoBalance -\n    (props.isFreeDrawing ? 0 : props.pendingPixels || 0);\n  const avocadoFarm =\n    account.avocadoPixels > 0 ? (\n      <span>\n        {\"(+\"}\n        <span className=\"font-weight-bold\">{account.avocadoPixels}</span>\n        {Avocado}\n        {\"/day)\"}\n      </span>\n    ) : (\n      \"\"\n    );\n  const bananaFarm =\n    account.bananaPixels > 0 ? (\n      <span>\n        {\"(+\"}\n        <span className=\"font-weight-bold\">{account.bananaPixels}</span>\n        {Banana}\n        {\"/day)\"}\n      </span>\n    ) : (\n      \"\"\n    );\n  return (\n    <span className=\"balances font-small\">\n      <span className=\"font-weight-bold\">\n        {avacadoBalance.toFixed(fraction)}\n      </span>\n      {Avocado}{\" \"}\n      <span className=\"font-weight-bold\">\n        {account.bananaBalance.toFixed(fraction)}\n      </span>\n      {Banana} {avocadoFarm}\n      {bananaFarm}\n      {props.pendingPixels ? <span> ({props.pendingPixels} pending)</span> : \"\"}\n    </span>\n  );\n};\n\nconst Leaderboard = (props) => {\n  const owners = props.owners.map((owner) => {\n    if (owner.accountIndex in props.accounts) {\n      owner.account = props.accounts[owner.accountIndex];\n    }\n    return (\n      <Owner\n        key={owner.accountIndex}\n        {...owner}\n        isSelected={owner.accountIndex === props.selectedOwnerIndex}\n        setHover={(v) => props.setHover(owner.accountIndex, v)}\n        isHighlighted={owner.accountIndex === props.highlightedAccountIndex}\n      />\n    );\n  });\n  return (\n    <table className=\"table table-hover table-sm\">\n      <tbody>{owners}</tbody>\n    </table>\n  );\n};\n\nconst Owner = (props) => {\n  const account = props.account;\n  return (\n    <tr\n      onMouseEnter={() => props.setHover(true)}\n      onMouseLeave={() => props.setHover(false)}\n      className={props.isSelected ? \"selected\" : \"\"}\n    >\n      <td>{account ? <Account accountId={account.accountId} /> : \"...\"}</td>\n      <td className=\"text-nowrap\">\n        <small>\n          <Balance account={account} />\n        </small>\n      </td>\n    </tr>\n  );\n};\n\nconst Account = (props) => {\n  const accountId = props.accountId;\n  const shortAccountId =\n    accountId.length > 6 + 6 + 3\n      ? accountId.slice(0, 6) + \"...\" + accountId.slice(-6)\n      : accountId;\n  return (\n    <a className=\"account\" href={`https://wayback.berryclub.io/${accountId}`}>\n      {shortAccountId}\n    </a>\n  );\n};\n\nexport default App;\n","import \"./Weapons.scss\";\nimport React from \"react\";\nimport Files from \"react-files\";\n\nconst Avocado = (\n  <span role=\"img\" aria-label=\"avocado\" className=\"berry\">\n    🥑\n  </span>\n);\n\nexport class Weapons extends React.Component {\n  constructor(props) {\n    super(props);\n    this.canvasRef = React.createRef();\n    this.state = {\n      width: 48,\n      height: 28,\n      avocadoNeeded: 100,\n      lockedAspect: true,\n    };\n  }\n\n  componentDidMount() {\n    this.canvas = this.canvasRef.current;\n    this.ctx = this.canvas.getContext(\"2d\");\n    this.sourceImage = new Image();\n    this.sourceImage.onload = () => {\n      this.draw();\n    };\n    this.sourceImage.src = \"/bfg.png\";\n  }\n\n  draw() {\n    const sourceImage = this.sourceImage;\n    const canvas = this.canvas;\n    const ctx = this.ctx;\n    const width = this.state.width;\n    const height = this.state.height;\n\n    // Create a canvas with the desired dimensions\n    canvas.width = width;\n    canvas.height = height;\n    canvas.style.width = width * 10 + \"px\";\n    canvas.style.height = height * 10 + \"px\";\n\n    // Scale and draw the source image to the canvas\n    ctx.clearRect(0, 0, width, height);\n    ctx.imageSmoothingQuality = \"low\";\n    ctx.drawImage(sourceImage, 0, 0, width, height);\n\n    const imageData = ctx.getImageData(0, 0, width, height);\n    this.imageData = imageData;\n    this.setState({\n      avocadoNeeded: new Uint32Array(imageData.data.buffer).reduce(\n        (sum, v) => sum + (v ? 1 : 0),\n        0\n      ),\n    });\n  }\n\n  async onFilesChange(f) {\n    const sourceImage = this.sourceImage;\n    let reader = new FileReader();\n\n    reader.readAsDataURL(f[0]);\n\n    sourceImage.onload = () => {\n      let width = sourceImage.naturalWidth;\n      let height = sourceImage.naturalHeight;\n      if (sourceImage.naturalWidth > 50 || sourceImage.naturalHeight > 50) {\n        const aspect = width / height;\n        width = Math.round(20 * Math.min(1, aspect));\n        height = Math.round(20 * Math.min(1, 1 / aspect));\n      }\n      this.setState({\n        width: Math.min(50, Math.max(1, width)),\n        height: Math.min(50, Math.max(1, height)),\n      });\n      this.draw();\n    };\n\n    reader.onload = function (event) {\n      sourceImage.src = event.target.result;\n    };\n  }\n\n  async onFilesError(e, f) {\n    console.log(e, f);\n  }\n\n  updateVal(key, value) {\n    value = Math.min(50, Math.max(1, value));\n    if (this.state.lockedAspect) {\n      const aspect =\n        this.sourceImage.naturalWidth / this.sourceImage.naturalHeight;\n      let width, height;\n      if (key === \"width\") {\n        width = value;\n        height = Math.round(width / aspect);\n      } else {\n        height = value;\n        width = Math.round(height * aspect);\n      }\n      this.setState(\n        {\n          width: Math.min(50, Math.max(1, width)),\n          height: Math.min(50, Math.max(1, height)),\n        },\n        () => {\n          this.draw();\n        }\n      );\n    } else {\n      this.setState(\n        {\n          [key]: value,\n        },\n        () => {\n          this.draw();\n        }\n      );\n    }\n  }\n\n  changeLockedAspect() {\n    this.setState({\n      lockedAspect: !this.state.lockedAspect,\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"weapons-popup\">\n        <div className=\"weapons-content\">\n          <h2>So you need a BFG?</h2>\n          <div>\n            <Files\n              type=\"button\"\n              className=\"btn\"\n              onChange={(f) => this.onFilesChange(f)}\n              onError={(e, f) => this.onFilesError(e, f)}\n              multiple={false}\n              accepts={[\"image/*\"]}\n              minFileSize={1}\n              clickable\n            >\n              Click to upload an image\n            </Files>\n          </div>\n          <div>\n            <label>Width</label>\n            <input\n              type=\"number\"\n              value={this.state.width}\n              min={1}\n              max={50}\n              onChange={(e) => this.updateVal(\"width\", e.target.value)}\n            />{\" \"}\n            <button\n              className={\n                \"btn btn-outline-secondary low-right-margin\" +\n                (this.state.lockedAspect ? \" btn-pressed\" : \" btn-not-pressed\")\n              }\n              onClick={() => this.changeLockedAspect()}\n            >\n              <span role=\"img\" aria-label=\"link\" className=\"berry\">\n                🔗\n              </span>\n            </button>\n            <label>Height</label>\n            <input\n              type=\"number\"\n              value={this.state.height}\n              min={1}\n              max={50}\n              onChange={(e) => this.updateVal(\"height\", e.target.value)}\n            />\n          </div>\n          <button\n            className=\"btn btn-success btn-large\"\n            disabled={\n              !this.props.account ||\n              (!this.props.isFreeDrawing &&\n                this.props.account.avocadoBalance < this.state.avocadoNeeded)\n            }\n            onClick={() =>\n              this.props.renderIt(this.imageData, this.state.avocadoNeeded)\n            }\n          >\n            Render on the board using {this.state.avocadoNeeded} {Avocado}\n          </button>\n          <div className=\"canvas-wrapper\">\n            <canvas\n              ref={this.canvasRef}\n              width={480}\n              height={280}\n              className=\"draw-preview\"\n            ></canvas>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}