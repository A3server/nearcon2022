(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{178:function(e,t,n){"use strict";(function(e){var a=n(2),r=n.n(a),s=n(25),c=n(179),i=n(180),o=n(182),l=n(181),u=n(183),h=(n(194),n(0)),f=n.n(h),d=n(42),p=n(62),_=function(e){return"#".concat(e.toString(16).padStart(6,"0"))},m=function(e){for(var t=[],n=0;n<31;++n)t.push("hsl(".concat(e,", 100%, ").concat(100*n/30,"%)"));return t},v=function(t){var n=e.from(t,"base64");if(404!==n.length)throw new Error("Unexpected encoded line length");for(var a=[],r=4;r<n.length;r+=8){var s=n.readUInt32LE(r),c=n.readUInt32LE(r+4);a.push({color:s,ownerIndex:c})}return a},g=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(o.a)(this,Object(l.a)(t).call(this,e))).state={connected:!1,signedIn:!1,accountId:null,balance:0,numPixels:0,boardLoaded:!1,selectedCell:null,currentColor:16711680,pickerColor:"#ff0000",colors:["#000000","#666666","#aaaaaa","#FFFFFF","#F44E3B","#D33115","#9F0500","#FE9200","#E27300","#C45100","#FCDC00","#FCC400","#FB9E00","#DBDF00","#B0BC00","#808900","#A4DD00","#68BC00","#194D33","#68CCCA","#16A5A5","#0C797D","#73D8FF","#009CE0","#0062B1","#AEA1FF","#7B64FF","#653294","#FDA1FF","#FA28FF","#AB149E"],gammaColors:m(0)},n._balanceRefreshTimer=null,n.canvasRef=f.a.createRef(),n._context=!1,n._lines=!1,n._initNear().then((function(){n.setState({connected:!0,signedIn:!!n._accountId,accountId:n._accountId})})),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.canvasRef.current;this._context=t.getContext("2d"),t.addEventListener("mousemove",(function(t){var n=Math.trunc(t.offsetX/16),a=Math.trunc(t.offsetY/16),r=null;n>=0&&n<50&&a>=0&&a<50&&(r={x:n,y:a}),JSON.stringify(r)!==JSON.stringify(e.state.selectedCell)&&e.setState({selectedCell:r},(function(){e.renderCanvas()}))})),t.addEventListener("click",function(){var t=Object(s.a)(r.a.mark((function t(n){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===e.state.selectedCell){t.next=4;break}return e.saveColor(),t.next=4,e.drawPixel(e.state.selectedCell);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"drawPixel",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.signedIn&&this._lines&&this._lines[t.y]){e.next=2;break}return e.abrupt("return");case 2:if((n=this._lines[t.y][t.x]).color===this.state.currentColor){e.next=9;break}return n.pending=!0,e.next=7,this._contract.draw({pixels:[{x:t.x,y:t.y,color:this.state.currentColor}]});case 7:return e.next=9,Promise.all([this.refreshBoard(),this.refreshAccountStats()]);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAccountStats",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,a,s,c=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=parseFloat,e.next=3,this._contract.get_account_balance({account_id:this._accountId});case 3:return e.t1=e.sent,t=(0,e.t0)(e.t1),e.next=7,this._contract.get_account_num_pixels({account_id:this._accountId});case 7:n=e.sent,this._balanceRefreshTimer&&(clearInterval(this._balanceRefreshTimer),this._balanceRefreshTimer=null),a=(new Date).getTime(),s=(n+1)*this._pixelCost/864e5,this.setState({balance:t/this._pixelCost,numPixels:n}),this._balanceRefreshTimer=setInterval((function(){var e=(new Date).getTime();c.setState({balance:(t+(e-a)*s)/c._pixelCost})}),100);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initNear",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={networkId:"default",nodeUrl:"https://rpc.testnet.near.org",contractName:"place.meta",walletUrl:"https://wallet.testnet.near.org"},n=new d.keyStores.BrowserLocalStorageKeyStore,e.next=4,d.connect(Object.assign({deps:{keyStore:n}},t));case 4:return a=e.sent,this._keyStore=n,this._nearConfig=t,this._near=a,this._walletConnection=new d.WalletConnection(a,"place.meta"),this._accountId=this._walletConnection.getAccountId(),this._account=this._walletConnection.account(),this._contract=new d.Contract(this._account,"place.meta",{viewMethods:["get_lines","get_line_versions","get_pixel_cost","get_account_balance","get_account_num_pixels","get_account_id_by_index"],changeMethods:["draw","buy_tokens"]}),e.t0=parseFloat,e.next=15,this._contract.get_pixel_cost();case 15:if(e.t1=e.sent,this._pixelCost=(0,e.t0)(e.t1),!this._accountId){e.next=20;break}return e.next=20,this.refreshAccountStats();case 20:return this._lineVersions=Array(50).fill(-1),this._lines=Array(50).fill(!1),e.next=24,this.refreshBoard();case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshBoard",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,a,s,c,i,o,l,u,h=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._contract.get_line_versions();case 2:for(t=e.sent,n=[],a=0;a<50;++a)t[a]!==this._lineVersions&&n.push(a);for(s=[],c=0;c<n.length;c+=10)s.push(n.slice(c,c+10));return e.next=9,Promise.all(s.map((function(e){return h._contract.get_lines({lines:e})})));case 9:for(i=(i=e.sent).flat(),s=s.flat(),o=0;o<s.length;++o)l=s[o],u=v(i[o]),this._lines[l]=u;this._lineVersions=t,this.renderCanvas();case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderCanvas",value:function(){if(this._context&&this._lines){for(var e=this._context,t=0;t<50;++t){var n=this._lines[t];if(n)for(var a=0;a<50;++a){var r=n[a];e.fillStyle=_(r.color),e.fillRect(16*a,16*t,16,16)}}if(this.state.selectedCell){var s=this.state.selectedCell;e.beginPath(),e.strokeStyle=_(this.state.currentColor),e.rect(16*s.x,16*s.y,16,16),e.stroke(),e.closePath()}this.state.boardLoaded||this.setState({boardLoaded:!0})}}},{key:"requestSignIn",value:function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"NEAR Place",e.next=3,this._walletConnection.requestSignIn("place.meta","NEAR Place");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logOut",value:function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._walletConnection.signOut(),this._accountId=null,this.setState({signedIn:!!this._accountId,accountId:this._accountId});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hueColorChange",value:function(e){this.setState({gammaColors:m(e.hsl.h)}),this.changeColor(e)}},{key:"saveColor",value:function(){var e=_(this.state.currentColor);-1===this.state.colors.indexOf(e)&&this.setState({colors:[e].concat(this.state.colors).slice(0,31)})}},{key:"changeColor",value:function(e){var t=this,n=65536*e.rgb.r+256*e.rgb.g+e.rgb.b;this.setState({pickerColor:e,currentColor:n},(function(){t.renderCanvas()}))}},{key:"render",value:function(){var e=this,t=this.state.connected?this.state.signedIn?f.a.createElement("div",null,f.a.createElement("div",{className:"float-right"},f.a.createElement("button",{className:"btn btn-outline-secondary",onClick:function(){return e.logOut()}},"Log out")),f.a.createElement("h4",null,"Hello, ",f.a.createElement("span",{className:"font-weight-bold"},this.state.accountId),"!"),f.a.createElement("div",null,"PIXEL tokens: ",this.state.balance.toFixed(6)),f.a.createElement("div",null,"Your pixels: ",this.state.numPixels),f.a.createElement("div",{className:"color-picker"},f.a.createElement(p.HuePicker,{color:this.state.pickerColor,width:"100%",disableAlpha:!0,onChange:function(t){return e.hueColorChange(t)}}),f.a.createElement(p.GithubPicker,{className:"circle-picker",colors:this.state.gammaColors,color:this.state.pickerColor,triangle:"hide",width:"100%",onChangeComplete:function(t){return e.changeColor(t)}}),f.a.createElement(p.GithubPicker,{className:"circle-picker",colors:this.state.colors,color:this.state.pickerColor,triangle:"hide",width:"100%",onChangeComplete:function(t){return e.hueColorChange(t)}}))):f.a.createElement("div",{style:{marginBottom:"10px"}},f.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.requestSignIn()}},"Log in with NEAR Wallet")):f.a.createElement("div",null,"Connecting... ",f.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}));return f.a.createElement("div",{className:"px-5"},f.a.createElement("h1",null,"NEAR Place"),t,f.a.createElement("div",null,f.a.createElement("canvas",{ref:this.canvasRef,width:800,height:800,className:this.state.boardLoaded?"pixel-board":"pixel-board c-animated-background"})))}}]),t}(f.a.Component);t.a=g}).call(this,n(13).Buffer)},184:function(e,t,n){e.exports=n(185)},185:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(177),c=n.n(s),i=(n(190),n(178));c.a.render(r.a.createElement(i.a,null),document.getElementById("root"))},190:function(e,t,n){},194:function(e,t,n){},199:function(e,t){},207:function(e,t){},221:function(e,t){},223:function(e,t){}},[[184,1,2]]]);
//# sourceMappingURL=main.cffb0e22.chunk.js.map